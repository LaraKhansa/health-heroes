<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screen-Free Activities - Health Heroes</title>
    <link rel="stylesheet" href="{{ url_for('screen_free.static', filename='css/activities.css') }}">
</head>
<body>
    <body>
    <!-- Language detection script -->
    <script>
        // Get language from URL or localStorage
        const urlParams = new URLSearchParams(window.location.search);
        let currentLanguage = urlParams.get('lang') || localStorage.getItem('userLanguage') || 'en';
        
        // Save to localStorage
        localStorage.setItem('userLanguage', currentLanguage);
        
        // Set page direction based on language
        if (currentLanguage === 'ar') {
            document.documentElement.setAttribute('dir', 'rtl');
            document.documentElement.setAttribute('lang', 'ar');
        } else {
            document.documentElement.setAttribute('dir', 'ltr');
            document.documentElement.setAttribute('lang', 'en');
        }
    </script>
    
    <!-- Header -->
    <header class="header">
        <div class="welcome-section">
            <h1 class="welcome-text">Welcome, {{ user_name }}</h1>
            <h2 class="app-title">Health Heroes ‚≠ê</h2>
            <div id="userStats" style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                <span id="completedCount" style="background: #66bb6a; color: white; padding: 5px 15px; border-radius: 15px; font-size: 14px; font-weight: 600;">
                    0 activities completed
                </span>
                <span id="userBadge" style="font-size: 24px; display: none;"></span>
            </div>
        </div>
        <a href="{{ url_for('auth.logout') }}" class="logout-btn" style="text-decoration: none; display: flex; align-items: center; justify-content: center;">Logout ‚¨Ü</a>
    </header>

    <!-- Main Content -->
    <main class="content">
        
        <!-- Page Title -->
        <div class="page-header">
            <h2 class="page-title">Screen-Free Activities</h2>
            <span class="game-icon">üéÆ</span>
        </div>
        <p class="page-subtitle">Engaging activities tailored for your family</p>

        <!-- Filter Section -->
        <div class="filter-section">
            <!-- Activity Type Dropdown -->
            <div class="dropdown-wrapper">
                <select class="filter-dropdown" id="activity-type">
                    <option value="all">All Activities</option>
                    <option value="games">Games & Play</option>
                    <option value="cooking">Healthy Cooking</option>
                    <option value="creative">Arts & Crafts</option>
                    <option value="nature">Outdoor Activities</option>
                    <option value="reading">Reading & Storytelling</option>
                    <option value="science">Science Experiments</option>
                </select>
            </div>

            <!-- Children Selection Dropdown -->
            <div class="dropdown-wrapper">
                <select class="filter-dropdown" id="child-selection">
                    <option value="all">All Children</option>
                    {% for child in children %}
                    <option value="{{ child.id }}" {% if child_filter == child.id|string %}selected{% endif %}>
                        {{ child.name }} ({{ child.get_age() }} years)
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Perfect for Your Home Section -->
        {% if home_resources %}
        <div class="home-resources">
            <h3 class="section-title">Perfect for Your Home</h3>
            <div class="resources-container">
                {% for resource in home_resources %}
                <div class="resource-item">
                    <span class="check-icon">‚úì</span>
                    <span data-resource="{{ resource }}">
                        {% if resource == 'kitchen' %}Kitchen Access
                        {% elif resource == 'balcony' %}Balcony Space
                        {% elif resource == 'garden' %}Garden/Backyard
                        {% elif resource == 'living_room' %}Living Room
                        {% elif resource == 'outdoor_nearby' %}Nearby Park
                        {% endif %}
                    </span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Get New Ideas Button -->
        <button class="new-ideas-btn">Get New Ideas</button>

        <!-- Suggestions Header -->
        <div class="suggestions-header">
            <span class="section-title">Suggestions</span>
            <span class="star-icon">‚≠ê</span>
        </div>
        
        <!-- Loading Spinner (add this new section) -->
        <div class="loading-spinner" id="loadingSpinner" style="display: none;">
            <div class="spinner"></div>
            <p>Loading activities...</p>
        </div>

        <!-- Activities List (from database) -->
        {% if activities %}
            <div class="activities-grid">
                {% for activity in activities %}
                <div class="activity-card" data-activity-id="{{ activity.id }}">
                    <div class="activity-header">
                        <h3 class="activity-title">{{ activity.title_ar if language == 'ar' else activity.title_en }}</h3>
                        <span class="activity-duration">{{ activity.duration }}</span>
                    </div>
                    
                    <p class="activity-age">Ages: {{ activity.age_range }}</p>
                    <p class="activity-description">{{ activity.description_ar if language == 'ar' else activity.description_en }}</p>
                    
                    <div class="materials-section">
                        <h4 class="materials-title">Materials Needed</h4>
                        <div class="materials-list">
                            {% for material in activity.get_materials() %}
                            <div class="material-badge {{ ['purple', 'green', 'orange', 'red', 'blue'][loop.index0 % 5] }}">
                                {% if material.icon %}
                                <span class="material-icon">{{ material.icon }}</span>
                                {% endif %}
                                <span>{{ material.name_ar if language == 'ar' else material.name_en }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="instructions-section">
                        <h4 class="instructions-title">Instructions</h4>
                        <ol class="instructions-list">
                            {% for step in (activity.get_steps_ar() if language == 'ar' else activity.get_steps_en())[:2] %}
                            <li>{{ step[:50] }}...</li>
                            {% endfor %}
                        </ol>
                        {% if (activity.get_steps_ar() if language == 'ar' else activity.get_steps_en())|length > 2 %}
                        <button class="more-steps">+ {{ (activity.get_steps_ar() if language == 'ar' else activity.get_steps_en())|length - 2 }} more steps...</button>
                        {% endif %}
                    </div>

                    <button class="start-activity-btn" onclick="openActivity({{ activity.id }})">Start Activity</button>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="text-align: center; padding: 40px; color: #999;">
                No activities available. Try changing filters!
            </p>
        {% endif %}

    </main>

    <!-- Activity Detail Modal -->
    <div class="modal-overlay" id="activityModal">
        <div class="modal-container">
            
            <!-- Close Button -->
            <button class="modal-close" id="closeModal">‚úï</button>
            
            <!-- Modal Header -->
            <div class="modal-header">
                <h2 class="modal-title">Indoor Treasure Hunt</h2>
                <p class="modal-step-indicator">Step 2 of 5</p>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 40%;"></div>
            </div>
            <p class="progress-text">1/5 steps</p>

            <!-- Main Content Box -->
            <div class="modal-content-box">
                <p class="activity-intro">Create a fun treasure hunt using items around your home</p>
            </div>

            <!-- Step Card with Number and Instruction -->
            <div class="step-card">
                <div class="step-number-bubble">
                    <span class="step-num">2</span>
                </div>
                <div class="step-text">
                    <p>Create simple picture clues for younger children or written clues for older ones!</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="modal-actions">
                <button class="complete-btn" id="completeBtn">Mark as Complete</button>
                <button class="pause-btn" id="pauseBtn">Pause & Celebrate! ‚ú®</button>
            </div>

        </div>
    </div>

    <script src="{{ url_for('screen_free.static', filename='js/activities.js') }}"></script>
</body>
</html>