<!DOCTYPE html>
<html lang="{{ 'ar' if language == 'ar' else 'en' }}" dir="{{ 'rtl' if language == 'ar' else 'ltr' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ 'Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' if language == 'ar' else 'AI Assistant' }} -  Afiyah</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>â­</text></svg>">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('chatbot.static', filename='chat.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/unified_header.css') }}">
</head>
<body>
    <!-- Header -->
    {% include 'header.html' %}
    {% include 'navigation.html' %}

    <!-- Main Container -->
    <div class="chat-container">
        <!-- Open Sidebar Button (shown when sidebar is hidden on desktop) -->
        <button class="open-sidebar-btn" id="openSidebarBtn" title="{{ 'ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©' if language == 'ar' else 'Open Sidebar' }}">
            â˜°
        </button>
        
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">
                    {{ 'Ù…Ø­Ø§Ø¯Ø«Ø§ØªÙŠ' if language == 'ar' else 'My Conversations' }}
                </h2>
                <div class="sidebar-header-buttons">
                    <button class="new-chat-btn" id="newChatBtn">
                        {{ '+ Ø¬Ø¯ÙŠØ¯' if language == 'ar' else '+ New' }}
                    </button>
                    <button class="close-sidebar-btn" id="closeSidebarBtn" title="{{ 'Ø¥ØºÙ„Ø§Ù‚' if language == 'ar' else 'Close' }}">
                        âœ•
                    </button>
                </div>
            </div>
            
            <div class="conversations-list" id="conversationsList">
                <!-- Conversations will be loaded here by JavaScript -->
                <div class="loading-message">
                    {{ 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' if language == 'ar' else 'Loading...' }}
                </div>
            </div>
            
            <!-- Mobile toggle button -->
            <button class="sidebar-toggle" id="sidebarToggle">
                <span>â˜°</span>
            </button>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-main">
            <!-- Welcome Screen (shown when no conversation selected) -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-content">
                    <h2 class="welcome-title">
                        {{ 'Ù…Ø±Ø­Ø¨Ø§Ù‹ ' + user_name + '! ğŸ‘‹' if language == 'ar' else 'Welcome ' + user_name + '! ğŸ‘‹' }}
                    </h2>
                    <p class="welcome-text">
                        {% if language == 'ar' %}
                            Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ®ØµØµ ÙÙŠ ØµØ­Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„ ÙˆØ§Ù„Ø£Ø³Ø±Ø©. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:
                        {% else %}
                            I'm your AI assistant specialized in child and family health. I can help you with:
                        {% endif %}
                    </p>
                    
                    <div class="topics-grid">
                        <div class="topic-card">
                            <span class="topic-icon">ğŸ¥—</span>
                            <span class="topic-text">{{ 'Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©' if language == 'ar' else 'Healthy Nutrition' }}</span>
                        </div>
                        <div class="topic-card">
                            <span class="topic-icon">ğŸƒ</span>
                            <span class="topic-text">{{ 'Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ' if language == 'ar' else 'Physical Activities' }}</span>
                        </div>
                        <div class="topic-card">
                            <span class="topic-icon">ğŸ˜´</span>
                            <span class="topic-text">{{ 'Ø§Ù„Ù†ÙˆÙ… ÙˆØ§Ù„Ø±ÙˆØªÙŠÙ†' if language == 'ar' else 'Sleep & Routines' }}</span>
                        </div>
                        <div class="topic-card">
                            <span class="topic-icon">ğŸ“±</span>
                            <span class="topic-text">{{ 'ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ø´Ø§Øª' if language == 'ar' else 'Screen Time' }}</span>
                        </div>
                        <div class="topic-card">
                            <span class="topic-icon">ğŸ‘¶</span>
                            <span class="topic-text">{{ 'Ø§Ù„ØªØ·ÙˆØ± ÙˆØ§Ù„Ø³Ù„ÙˆÙƒ' if language == 'ar' else 'Development' }}</span>
                        </div>
                        <div class="topic-card">
                            <span class="topic-icon">ğŸ•Œ</span>
                            <span class="topic-text">{{ 'Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©' if language == 'ar' else 'UAE Culture' }}</span>
                        </div>
                    </div>
                    
                    <button class="start-chat-btn" id="startChatBtn">
                        {{ 'Ø§Ø¨Ø¯Ø£ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©' if language == 'ar' else 'Start New Chat' }}
                    </button>
                </div>
            </div>

            <!-- Chat Messages Area -->
            <div class="chat-messages" id="chatMessages" style="display: none;">
                <!-- Messages will appear here -->
            </div>

            <!-- Input Area -->
            <div class="chat-input-container" id="chatInputContainer" style="display: none;">
                <form class="chat-form" id="chatForm">
                    <textarea 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="{{ 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...' if language == 'ar' else 'Type your message here...' }}"
                        rows="1"
                    ></textarea>
                    <button type="submit" class="send-btn" id="sendBtn">
                        <span class="send-icon">{{ 'â†' if language == 'ar' else 'â†’' }}</span>
                    </button>
                </form>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // Pass data from Flask to JavaScript
        const LANGUAGE = "{{ language }}";
        const USER_ID = {{ session.user_id }};
    </script>

    <!-- Add Marked.js library for markdown support -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="{{ url_for('chatbot.static', filename='chat.js') }}"></script>
</body>
</html>